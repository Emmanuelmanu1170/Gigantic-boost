<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kwabenamedia — Place Order</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family:'Montserrat',sans-serif;background:#f5f5f5;margin:0;padding:20px; }
    .container { max-width:500px;background:#fff;padding:25px;border-radius:12px;
      box-shadow:0 0 10px rgba(0,0,0,0.1);margin:0 auto; }
    h2 { text-align:center;color:#1a8917; }
    label { font-weight:600;display:block;margin-top:15px; }
    select,input { width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;margin-top:5px; }
    button { width:100%;background:#1a8917;color:white;padding:12px;border:none;border-radius:6px;
      font-weight:600;margin-top:20px;cursor:pointer; }
    button:hover { background:#157012; }
    .price-box { margin-top:15px;background:#f9f9f9;padding:10px;border-radius:6px; }
  </style>
</head>
<body>

<div class="container">
  <h2>Place Your Order</h2>
  
  <label>Platform</label>
  <select id="platform"><option value="">-- Select Platform --</option></select>

  <label>Service</label>
  <select id="service"><option value="">-- Select Service --</option></select>

  <label>Quantity (Per 1000)</label>
  <input type="number" id="quantity" value="200" min="200">

  <div class="price-box">
    <p><strong>Price in USD:</strong> $<span id="priceUSD">0</span></p>
  </div>

  <label>Username / Link</label>
  <input type="text" id="username" placeholder="Enter username or post link">

  <label>Email</label>
  <input type="email" id="email" placeholder="you@example.com">

  <label>Phone</label>
  <input type="text" id="phone" placeholder="e.g. +233xxxxxxxxx">

  <button id="placeBtn">Place Order</button>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
  import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCGoDeUIKI_aWPV-Ys6Swlw9YQNcVhn5dY",
    authDomain: "kwabenamedia.firebaseapp.com",
    databaseURL: "https://kwabenamedia-default-rtdb.firebaseio.com",
    projectId: "kwabenamedia",
    storageBucket: "kwabenamedia.appspot.com",
    messagingSenderId: "508812066118",
    appId: "1:508812066118:web:5bf0b2f7f7844d05b3b947"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const services = {
    "TikTok": {
      "Followers (Refill 20 days)": { id:18236, price:3.7 },
      "Followers Non Drop": { id:10135, price:5.7 },
      "Likes (Refill 20 days)": { id:13088, price:0.9 },
      "Views": { id:17776, price:0.9 }
    },
    "Instagram": {
      "Followers Real Accounts": { id:27270, price:7 },
      "Likes Non Drop": { id:27295, price:1 },
      "Views Non Drop": { id:11184, price:1.5 }
    },
    "YouTube": {
      "Views Non Drop": { id:24978, price:4.8 },
      "Subscribers Lifetime Guaranteed": { id:18274, price:65 }
    }
  };

  const platformSelect = document.getElementById("platform");
  Object.keys(services).forEach(p=>{
    const opt=document.createElement("option");
    opt.value=p; opt.textContent=p; platformSelect.appendChild(opt);
  });

  const serviceSelect = document.getElementById("service");
  platformSelect.addEventListener("change",()=>{
    serviceSelect.innerHTML='<option value="">-- Select Service --</option>';
    const selected=platformSelect.value;
    if(selected && services[selected]){
      Object.keys(services[selected]).forEach(s=>{
        const opt=document.createElement("option");
        opt.value=s; opt.textContent=s; serviceSelect.appendChild(opt);
      });
    }
  });

  const quantityInput=document.getElementById("quantity");
  const priceUSDSpan=document.getElementById("priceUSD");
  serviceSelect.addEventListener("change",updatePrice);
  quantityInput.addEventListener("input",updatePrice);

  function updatePrice(){
    const platform=platformSelect.value;
    const service=serviceSelect.value;
    const qty=parseFloat(quantityInput.value)||0;
    if(platform && service && services[platform][service]){
      const base=services[platform][service].price;
      const price=(qty/1000)*base;
      priceUSDSpan.textContent=price.toFixed(2);
    } else { priceUSDSpan.textContent="0"; }
  }

  document.getElementById("placeBtn").addEventListener("click", async ()=>{
    const platform=platformSelect.value;
    const service=serviceSelect.value;
    const qty=quantityInput.value;
    const price=priceUSDSpan.textContent;
    const username=document.getElementById("username").value.trim();
    const email=document.getElementById("email").value.trim();
    const phone=document.getElementById("phone").value.trim();

    if(!platform || !service || !qty || !username || !email || !phone){
      alert("Please fill all fields correctly.");
      return;
    }

    // generate reference ID
    const reference="ORD"+Date.now().toString().slice(-6);

    const orderData={
      reference,
      platform,
      service,
      quantity:qty,
      totalUSD:price,
      username,
      email,
      phone,
      date:new Date().toLocaleString(),
      status:"Pending",
      uid:"guest"
    };

    try{
      // ✅ Save to admin orders
      const adminRef=ref(db,"adminOrders");
      await push(adminRef,orderData);
      // ✅ Save to user orders (if signed in, use uid)
      const userRef=ref(db,"orders/guest");
      await push(userRef,orderData);
      alert("✅ Order placed successfully!");
      window.location.href="order-history.html";
    }catch(err){
      console.error(err);
      alert("❌ Failed to place order. Try again.");
    }
  });
</script>

</body>
</html>