<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kwabenamedia ‚Äî Place Order</title>

  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Montserrat', sans-serif; }
    body { background: #f3f7fc; display: flex; min-height: 100vh; }
    .sidebar { background: #003366; color: #fff; width: 240px; padding: 25px 10px; display: flex; flex-direction: column; align-items: flex-start; position: fixed; height: 100%; }
    .sidebar h2 { width: 100%; text-align: center; margin-bottom: 30px; color: #fff; font-size: 22px; font-weight: 700; }
    .sidebar a { color: #fff; text-decoration: none; display: block; width: 100%; padding: 12px 15px; border-radius: 8px; margin: 5px 0; transition: background 0.25s; font-weight: 500; }
    .sidebar a:hover, .sidebar a.active { background: #0055aa; }
    .main { flex: 1; padding: 40px; margin-left: 240px; }
    .container { background: #fff; border: 1px solid #dce3ee; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,.05); max-width: 650px; margin: auto; padding: 25px; }
    h2 { text-align: center; color: #004aad; margin-bottom: 20px; }
    label { display: block; margin-top: 12px; font-weight: 600; color: #333; }
    select, input { width: 100%; padding: 10px; margin-top: 6px; border-radius: 6px; border: 1px solid #cdd5e0; outline: none; font-size: 14px; }
    .price-box { margin-top: 10px; background: #f7f9fc; padding: 12px; border-radius: 6px; border: 1px solid #e1e7f0; }
    button { background: #004aad; color: #fff; border: none; width: 100%; padding: 12px; border-radius: 6px; font-size: 16px; margin-top: 18px; cursor: pointer; transition: background 0.25s; }
    button:hover { background: #003b88; }
    .balance { font-weight: 700; color: #004aad; }
    @media(max-width: 768px) {
      body { flex-direction: column; }
      .sidebar { width: 100%; flex-direction: row; overflow-x: auto; justify-content: space-around; position: relative; height: auto; }
      .main { padding: 20px; margin-left: 0; }
    }
    #refreshBalance {
      background: #004aad;
      color: #fff;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      margin-left: 10px;
      transition: 0.3s;
    }
    #refreshBalance:hover { background: #003b88; }
  </style>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCGoDeUIKI_aWPV-Ys6Swlw9YQNcVhn5dY",
      authDomain: "kwabenamedia.firebaseapp.com",
      databaseURL: "https://kwabenamedia-default-rtdb.firebaseio.com",
      projectId: "kwabenamedia",
      storageBucket: "kwabenamedia.firebasestorage.app",
      messagingSenderId: "508812066118",
      appId: "1:508812066118:web:5bf0b2f7f7844d05b3b947",
      measurementId: "G-FWT4S09Z9L"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();
  </script>
</head>

<body>
  <div class="sidebar">
    <h2>Kwabenamedia</h2>
    <a href="dashboard.html">üè† Dashboard</a>
    <a href="order.html" class="active">üõí Place Order</a>
    <a href="order-history.html">üìã Order History</a>
    <a href="add-funds.html">üí∞ Add Funds</a>
    <a href="funds-history.html">üßæ Funds History</a>
    <a href="settings.html">‚öôÔ∏è Settings</a>
  </div>

  <div class="main">
    <div class="container">
      <h2>Place Your Order</h2>

      <label>Platform</label>
      <select id="platform">
        <option value="">-- Select Platform --</option>
      </select>

      <label>Service</label>
      <select id="service"><option value="">-- Select Service --</option></select>

      <label>Quantity (Per 1000)</label>
      <input type="number" id="quantity" value="200" min="200">

      <div class="price-box">
        <p><strong>Price in USD:</strong> $<span id="priceUSD">0</span></p>
        <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 10px;">
          <p class="balance">Balance: $<span id="balanceValue">0.00</span></p>
          <button id="refreshBalance">üîÑ Refresh</button>
        </div>
      </div>

      <label>Username / Link</label>
      <input type="text" id="username" placeholder="Enter username or post link">

      <label>Email</label>
      <input type="email" id="email" placeholder="you@example.com">

      <label>Phone</label>
      <input type="text" id="phone" placeholder="e.g. +233xxxxxxxxx">

      <button id="placeBtn">Place Order</button>
    </div>
  </div>

  <script>
    const prices = {
      TikTok: { "Followers (Refill 20 Days) (ID 18236)": 3.7, "Followers Non Drop (ID 10135)": 5.7 },
      Instagram: { "Followers Real Accounts (ID 27270)": 7 },
      YouTube: { "Subscribers Lifetime Guaranteed (ID 18274)": 65 },
      Telegram: { "Members Non Drop (ID 15521)": 4 },
      Facebook: { "Likes (ID 10036)": 3 },
      WhatsApp: { "Channel Members (ID 18706)": 13 },
      LinkedIn: { "AI Growth (ID 20944)": 100 }
    };

    const platformSelect = document.getElementById("platform");
    const serviceSelect = document.getElementById("service");
    const quantityInput = document.getElementById("quantity");
    const priceUSD = document.getElementById("priceUSD");
    const balanceValue = document.getElementById("balanceValue");
    const refreshBtn = document.getElementById("refreshBalance");
    const placeBtn = document.getElementById("placeBtn");

    Object.keys(prices).forEach(p => {
      const opt = document.createElement("option");
      opt.value = p;
      opt.textContent = p;
      platformSelect.appendChild(opt);
    });

    platformSelect.addEventListener("change", () => {
      serviceSelect.innerHTML = '<option value="">-- Select Service --</option>';
      const list = prices[platformSelect.value];
      if (list) Object.keys(list).forEach(s => {
        const opt = document.createElement("option");
        opt.value = s;
        opt.textContent = s;
        serviceSelect.appendChild(opt);
      });
      updatePrice();
    });

    function updatePrice() {
      const p = platformSelect.value;
      const s = serviceSelect.value;
      const q = parseInt(quantityInput.value) || 0;
      if (p && s && q > 0) {
        const usd = prices[p][s];
        priceUSD.textContent = (usd * q / 1000).toFixed(2);
      } else priceUSD.textContent = "0";
    }

    serviceSelect.addEventListener("change", updatePrice);
    quantityInput.addEventListener("input", updatePrice);

    let currentUser = null;
    auth.onAuthStateChanged(user => {
      if (!user) return (window.location.href = "index.html");
      currentUser = user;
      const balRef = db.ref(`users/${user.uid}/balance`);
      balRef.on("value", snap => {
        const val = parseFloat(snap.val()) || 0;
        balanceValue.textContent = val.toFixed(2);
      });
    });

    refreshBtn.addEventListener("click", async () => {
      if (!currentUser) return alert("Please login again.");
      const snap = await db.ref(`users/${currentUser.uid}/balance`).once("value");
      const val = parseFloat(snap.val()) || 0;
      balanceValue.textContent = val.toFixed(2);
      alert("üîÅ Balance refreshed successfully!");
    });

    placeBtn.addEventListener("click", async () => {
      if (!currentUser) return alert("Please login again.");

      const platform = platformSelect.value;
      const service = serviceSelect.value;
      const qty = parseInt(quantityInput.value);
      const price = parseFloat(priceUSD.textContent);
      const username = document.getElementById("username").value.trim();
      const email = document.getElementById("email").value.trim();
      const phone = document.getElementById("phone").value.trim();

      if (!platform || !service || qty < 200 || !username || !email || !phone)
        return alert("‚ö†Ô∏è Please fill all fields. Minimum order is 200 units.");

      const balanceRef = db.ref(`users/${currentUser.uid}/balance`);
      const balSnap = await balanceRef.once("value");
      const currentBalance = parseFloat(balSnap.val()) || 0;

      if (currentBalance < price) return alert("‚ùå Insufficient balance!");

      const reference = "ORD-" + Date.now().toString().slice(-8);
      const orderObj = {
        uid: currentUser.uid,
        platform,
        service,
        quantity: qty,
        totalUSD: price.toFixed(2),
        username,
        email,
        phone,
        reference,
        date: new Date().toLocaleString(),
        status: "Pending"
      };

      try {
        await balanceRef.set(currentBalance - price);
        await db.ref(`orders/${currentUser.uid}/${reference}`).set(orderObj);
        await db.ref(`adminOrders/${reference}`).set(orderObj);

        alert("‚úÖ Order placed successfully!");
        window.location.href = "admin-order.html"; // ‚úÖ sends details to admin page
      } catch (e) {
        alert("Error: " + e.message);
      }
    });
  </script>
</body>
</html>